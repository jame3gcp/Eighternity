# Ask 페이지 AI 요청 정보 상세

## 📋 개요

Ask 페이지의 7가지 카테고리 버튼(애정운, 재물운, 직업운, 건강운, 이동수, 만남, 연락)을 클릭하면 OpenAI GPT-4o에 전송되는 정보를 정리한 문서입니다.

---

## 🔄 데이터 흐름

```
사용자 클릭 (카테고리 선택)
  ↓
프론트엔드 → API 요청
  ↓
API: 쿠키에서 사주 정보 읽기
  ↓
API: 사주 정보 계산 및 구성
  ↓
OpenAI API 요청 (프롬프트 구성)
  ↓
AI 답변 생성
```

---

## 1️⃣ 프론트엔드 → API 요청 정보

### 요청 본문 (JSON)

```json
{
  "category": "love" | "money" | "work" | "health" | "move" | "meeting" | "contact",
  "templateId": "love-1" (선택사항),
  "question": "이번 달 연애운은 어떤가요?" (선택사항)
}
```

### 카테고리 매핑

| 프론트엔드 버튼 | API 카테고리 | 설명 |
|---------------|------------|------|
| ❤️ 애정운 | `love` | 연애, 인연 관련 질문 |
| 💰 재물운 | `money` | 돈, 투자, 사업 관련 질문 |
| 💼 직업운 | `work` | 직업, 이직, 프로젝트 관련 질문 |
| 🌿 건강운 | `health` | 건강, 운동, 다이어트 관련 질문 |
| ✈️ 이동수 | `move` | 이사, 여행, 출장 관련 질문 |
| 👥 만남 | `meeting` | 새로운 사람과의 만남 관련 질문 |
| 📞 연락 | `contact` | 연락, 소통 관련 질문 |

---

## 2️⃣ API에서 처리하는 정보

### 쿠키에서 읽는 정보

```typescript
// user_saju 쿠키에서 읽음
{
  birthDate: "1984-11-16",
  birthTime: "01:00" | null,
  gender: "M" | "F" | "O",
  fiveElements: { wood, fire, earth, metal, water },
  userId: "uuid"
}
```

### 계산되는 사주 정보

```typescript
// getSajuProfile()으로 계산
sajuInfo = {
  pillars: {
    year: "甲子",    // 년주
    month: "乙亥",   // 월주
    day: "丙寅",     // 일주
    hour: "戊子"     // 시주
  },
  fiveElements: {
    wood: 30,        // 목(木) %
    fire: 25,        // 화(火) %
    earth: 15,       // 토(土) %
    metal: 20,       // 금(金) %
    water: 10        // 수(水) %
  },
  dayMaster: "丙",   // 일간
  tenGods: {         // 십성 분포
    "비견": 1,
    "식신": 2,
    "상관": 1,
    "정재": 1,
    "편재": 0,
    "정관": 1,
    "편관": 0,
    "정인": 1,
    "편인": 0,
    "겁재": 1
  }
}
```

---

## 3️⃣ OpenAI API에 전송되는 정보

### System Prompt (시스템 프롬프트)

```
당신은 명리학(사주명리학) 전문가이자 현명한 조언자입니다. 
사용자의 사주 정보를 바탕으로 개인화된 답변을 제공합니다.

## 역할과 원칙
1. 사주 기반 분석: 사용자의 사주(오행, 십성, 기운)를 정확히 분석하여 답변합니다.
2. 긍정적이고 실용적인 조언: 운명론적 공포를 주지 않고, 구체적이고 실현 가능한 행동을 제안합니다.
3. 3단계 구조: 모든 답변은 요약 - 이유 - 액션 플랜으로 구성됩니다.
4. 개인화: 제공된 사주 정보를 반드시 활용하여 개인 맞춤형 답변을 제공합니다.

## 답변 형식
{
  "summary": "한 문장 요약 (20-30자)",
  "reasoning": "사주 기반 이유 설명 (100-150자)",
  "actionPlan": "구체적 행동 제안 (80-120자)",
  "confidence": 0-100 사이의 숫자
}
```

### User Prompt (사용자 프롬프트)

#### 사주 정보가 있는 경우

```
다음 질문에 대해 명리학 기반으로 답변해주세요.

**질문**: 이번 달 연애운은 어떤가요?
(또는 **카테고리**: 애정운)

## 사용자 사주 정보

**사주**: 甲子 乙亥 丙寅 戊子
**일간**: 丙
**오행 분포**:
- 목(木): 30%
- 화(火): 25%
- 토(土): 15%
- 금(金): 20%
- 수(水): 10%

**십성**: 비견(1), 식신(2), 상관(1), 정재(1), 정관(1), 정인(1), 겁재(1)

위 사주 정보를 바탕으로 개인화된 답변을 제공해주세요.

## 답변 요구사항

1. **요약**: 한 문장으로 핵심 답변을 제시하세요 (20-30자).
2. **이유**: 사주 기반으로 왜 그런지 설명하세요 (100-150자).
3. **액션 플랜**: 구체적이고 실현 가능한 행동을 제안하세요 (80-120자).
4. **신뢰도**: 답변의 신뢰도를 0-100 사이 숫자로 평가하세요.

JSON 형식으로 답변하세요.
```

#### 사주 정보가 없는 경우

```
다음 질문에 대해 명리학 기반으로 답변해주세요.

**카테고리**: 애정운

사주 정보가 제공되지 않았습니다. 일반적인 명리학 원칙에 따라 답변해주세요.

## 답변 요구사항
...
```

---

## 4️⃣ 각 카테고리별 포함 정보

### 모든 카테고리 공통 정보

✅ **항상 포함**:
- 선택한 카테고리 (`love`, `money`, `work`, `health`, `move`, `meeting`, `contact`)
- 시스템 프롬프트 (명리학 전문가 역할 정의)
- 답변 형식 요구사항 (요약, 이유, 액션 플랜, 신뢰도)

✅ **사주 정보가 있는 경우 포함**:
- 사주 4주 (년주, 월주, 일주, 시주)
- 일간 (일간 천간)
- 오행 분포 (목, 화, 토, 금, 수 각각 %)
- 십성 분포 (비견, 식신, 상관, 정재, 편재, 정관, 편관, 정인, 편인, 겁재)

### 카테고리별 특화 정보

| 카테고리 | 특화 정보 | 예시 질문 |
|---------|---------|----------|
| **애정운** (`love`) | 연애, 인연, 관계 | "이번 달 연애운은 어떤가요?" |
| **재물운** (`money`) | 돈, 투자, 사업 | "투자나 사업을 시작해도 될까요?" |
| **직업운** (`work`) | 직업, 이직, 프로젝트 | "이직이나 전환을 고려해도 될까요?" |
| **건강운** (`health`) | 건강, 운동, 다이어트 | "운동이나 다이어트를 시작해도 될까요?" |
| **이동수** (`move`) | 이사, 여행, 출장 | "이번 달 이사해도 될까요?" |
| **만남** (`meeting`) | 새로운 사람과의 만남 | "새로운 사람과의 만남이 좋을까요?" |
| **연락** (`contact`) | 연락, 소통 | "연락을 취해도 될까요?" |

---

## 5️⃣ 실제 요청 예시

### 예시 1: 애정운 카테고리 선택 (사주 정보 있음)

```json
// API 요청
{
  "category": "love"
}

// OpenAI에 전송되는 User Prompt
다음 질문에 대해 명리학 기반으로 답변해주세요.

**카테고리**: 애정운

## 사용자 사주 정보

**사주**: 甲子 乙亥 丙寅 戊子
**일간**: 丙
**오행 분포**:
- 목(木): 30%
- 화(火): 25%
- 토(土): 15%
- 금(金): 20%
- 수(水): 10%

**십성**: 비견(1), 식신(2), 상관(1), 정재(1), 정관(1), 정인(1), 겁재(1)

위 사주 정보를 바탕으로 개인화된 답변을 제공해주세요.
```

### 예시 2: 질문 템플릿 선택 (사주 정보 있음)

```json
// API 요청
{
  "templateId": "money-2",
  "category": "money"
}

// OpenAI에 전송되는 User Prompt
다음 질문에 대해 명리학 기반으로 답변해주세요.

**질문**: 투자나 사업을 시작해도 될까요?

## 사용자 사주 정보
... (동일)
```

### 예시 3: 사주 정보 없음

```json
// API 요청
{
  "category": "work"
}

// OpenAI에 전송되는 User Prompt
다음 질문에 대해 명리학 기반으로 답변해주세요.

**카테고리**: 직업운

사주 정보가 제공되지 않았습니다. 일반적인 명리학 원칙에 따라 답변해주세요.
```

---

## 6️⃣ AI 답변 형식

```json
{
  "summary": "이번 달은 새로운 인연의 기운이 강합니다.",
  "reasoning": "당신의 사주에서 화(火) 기운이 강하고 식신이 많아 매력적이고 소통 능력이 뛰어납니다. 특히 이번 달은 목(木) 기운이 도와 화를 돕는 구조로, 새로운 만남이나 관계 발전에 유리한 시기입니다.",
  "actionPlan": "1) 새로운 모임이나 활동에 적극 참여하기 2) 자신의 매력을 자연스럽게 표현하기 3) 상대방의 이야기에 귀 기울이기",
  "category": "love",
  "confidence": 85
}
```

---

## 📊 요약

### 항상 포함되는 정보
- ✅ 선택한 카테고리
- ✅ 시스템 프롬프트 (명리학 전문가 역할)
- ✅ 답변 형식 요구사항

### 사주 정보가 있는 경우 추가 포함
- ✅ 사주 4주 (년주, 월주, 일주, 시주)
- ✅ 일간
- ✅ 오행 분포 (목, 화, 토, 금, 수 %)
- ✅ 십성 분포

### 선택적 정보
- ⚪ 질문 템플릿 ID (템플릿 선택 시)
- ⚪ 직접 입력한 질문 (템플릿 대신 사용자 질문 입력 시)

---

## 🔍 확인 방법

서버 콘솔에서 다음 로그를 확인할 수 있습니다:

```
✅ OpenAI client initialized, starting question analysis...
📋 질문 요청: {
  category: 'love',
  question: '이번 달 연애운은 어떤가요?',
  hasSajuInfo: true
}
📤 OpenAI API 요청 전송 중 (질문 답변)...
📥 OpenAI 응답 수신 완료 (질문 답변)
✅ JSON 파싱 완료
📊 답변 결과 요약:
  - 요약: ...
  - 카테고리: love
  - 신뢰도: 85
```
